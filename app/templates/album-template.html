<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>chermoz</title>
    <link rel="stylesheet" href="../static/css/style.css" />
</head>
<body>
    <header>
        <div class="container nav no-select">
            <span class="title no-select">ЧЕРМОЗ</span>
            <span class="nav-menu no-select">
                <span class="menu-item no-select"><a href="/">ГЛАВНАЯ</a></span>
                <span class="menu-item middle no-select"><a href="/album">ФОТОАЛЬБОМ</a></span>
                {% if user %}
                <span class="menu-item no-select">{{ user.username|upper }}</span>
                <span class="logout no-select"><a href="/logout"><img src="../static/images/logout.svg" alt=""></a></span>
                {% else %}
                <span class="menu-item no-select login"><a href="/login">ВХОД</a></span>
                {% endif %}
            </span>
            <span class="nav-handler no-select" id="nav-handler">
                <img class="no-select" id="menu-icon" src="../static/images/menu.svg" alt="">
            </span>
        </div>
    </header>
    <div class="more no-select" id="more">
        <div class="container no-select">
            <div class="menu-item no-select"><a href="/">ГЛАВНАЯ</a></div>
            <div class="menu-item vertical-middle no-select"><a href="/album">ФОТОАЛЬБОМ</a></div>
            {% if user %}
            <div class="logout-container vertical-last no-select">
                <span class="menu-item no-select">{{ user.username|upper }}</span>
                <span class="logout no-select"><a href="/logout"><img src="../static/images/logout.svg" alt=""></a></span>
            </div>
            {% else %}
            <div class="menu-item vertical-last no-select"><a href="/login">ВХОД</a></div>
            {% endif %}
        </div>
    </div>
    <div class="updates no-select">
        <div class="container no-select">
            <div class="add">добавить</div>
            {% for album in albums %}
            <div class="title no-select">Альбом {{ album.id }}</div>
            <div class="albums">
                {% if user.admin %}
                <div class="gallery-item first" data-album-id="{{ album.id }}">
                    <div class="plus-container">
                        <img src="../static/images/plus.svg" alt="">
                    </div>
                </div>
                {% endif %}
                {% for photo in photos[album.id] %}
                <div class="gallery-item photo">
                    <img src="{{ url_for('static', filename=photo.path) }}" alt="">
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="popup" id="popup">
        <div class="popup-content">
            <form action="{{url_for('upload')}}" method="post" enctype="multipart/form-data">
                <input type="hidden" name="album_id" value="">
                <input type="hidden" name="section_id" value="">
                <input type="file" name="file">
                <input type="submit" value="Загрузить">
            </form>
        </div>
    </div>
    <div class="popup" id="popup2">
        <div class="popup-content">
            <form action="/addAlbum" method="post">
                <label for="popup-title">Название альбома:</label><br/>
                <input type="text" id="popup-title" name="popup-title" maxlength="30" placeholder="Введите название"/><br/><br/>
                <label for="popup-desc">Описание альбома:</label><br />
                <textarea id="popup-desc" name="popup-desc" maxlength="100" placeholder="Введите описание"></textarea><br/><br/>
                <button type="submit">Создать</button>
            </form>
        </div>
    </div>

    <script src="../static/js/header.js"></script>
    <script>
        const path = window.location.pathname;
        const segments = path.split('/');
        const id = segments[segments.length - 1];
        const firstItems = document.querySelectorAll('.gallery-item.first');
        const popup = document.getElementById('popup');
        const albumInput = document.querySelector('input[name="album_id"]');
        const sectionInput = document.querySelector('input[name="section_id"]');

        firstItems.forEach((firstItem) => {
            firstItem.addEventListener('click', () => {
                albumInput.value = firstItem.getAttribute('data-album-id');
                sectionInput.value = id;
                popup.classList.add('open');
            });
        });

        const add = document.querySelector('.add');
        const popup2 = document.getElementById('popup2');
        const doneButton2 = document.getElementById('popup-done');

        add.addEventListener('click', () => {
            popup2.classList.add('open');
        });
    </script>
</body>
</html>
